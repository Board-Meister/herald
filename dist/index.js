var i=class{#t={};#r={};#o=null;constructor(t=null){this.#o=t}async dispatch(t,r={}){this.#e(t);for(let o of this.#s(t.type,r))try{if(await this.#i(o)(t),this.#n(t))break}catch(n){throw console.error("Dispatcher error:",n),n}}dispatchSync(t,r={}){this.#e(t);for(let o of this.#s(t.type,r))try{if(this.#i(o)(t),this.#n(t))break}catch(n){throw console.error("Dispatcher error:",n),n}}batch(t){let r=[];return t.forEach(({event:o,subscription:n,constraint:e=null,sort:s=!0,symbol:c=null,anchor:u=null})=>{r.push(this.listen({event:o,subscription:n,constraint:e,sort:s,symbol:c,anchor:u}))}),()=>{r.forEach(o=>{o()})}}listen({event:t,subscription:r,constraint:o=null,sort:n=!0,symbol:e=null,anchor:s=null}){return this.register(t,r,o,n,e,s)}register(t,r,o=null,n=!0,e=null,s=null){e??=this.#l();let c=this.#c(r,o,s),u=this.#u(t,e,c);return n&&this.#h(t),u}unregister(t,r){if(!this.#r[r]){console.warn("Tried to unregister not registered events",t);return}let o=[...this.#t[t]];this.#r[r].forEach(n=>{let e=o.indexOf(n);if(e!==-1)o.splice(e,1);else throw new Error("Attempt to remove event from wrong collection")}),this.#t[t]=o,delete this.#r[r]}#c(t,r=null,o=null){let n=Array.isArray(t)?t:[typeof t=="object"?t:{method:t}],e=[];for(let s of n)e.push({method:s.method,priority:s.priority??0,constraint:s.constraint??r,anchor:s.anchor??o});return e}#u(t,r,o){return this.#t[t]=[...this.#t[t]??[],...o],this.#r[r]=[...this.#r[r]??[],...o],()=>{this.unregister(t,r)}}#l(){return Symbol("event")}#n(t){return t.cancelBubble}#e(t){if(!(t instanceof CustomEvent))throw new Error("Event passed to dispatcher must be of type CustomEvent")}#s(t,{origin:r=null,direction:o="up"}){let n=[];for(let e of this.#t[t]??[])this.#a(e,r,o)&&n.push(e);return n}#a(t,r,o){return!r&&t.anchor||!t.anchor&&r?!1:t.anchor===r?!0:!(t.anchor instanceof Node)||!(r instanceof Node)?!1:o=="up"&&t.anchor.contains(r)||o=="down"&&r.contains(t.anchor)||o=="both"&&(r.contains(t.anchor)||t.anchor.contains(r))}#i(t){let r=t.constraint,o=typeof r=="string"?this.#o?.get(r):r,n=t.method;if(o&&typeof n=="string"&&(n=o[n]??null,n&&(n=n.bind(o))),typeof n!="function")throw console.error("Error below is related to this subscriber",t),new Error("Subscriber doesn't have proper method");return n}#h(t){this.#t[t].sort((r,o)=>r.priority-o.priority)}};var p=i;export{i as Herald,p as default};
