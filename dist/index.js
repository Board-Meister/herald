var n=class{#t={};#r={};#o=null;constructor(t=null){this.#o=t}async dispatch(t,{origin:r=null}={}){this.#s(t);for(let o of this.#e(t.type,r))try{if(await this.#n(o)(t),this.#i(t))break}catch(i){throw console.error("Dispatcher error:",i),i}}dispatchSync(t,{origin:r=null}={}){this.#s(t);for(let o of this.#e(t.type,r))try{if(this.#n(o)(t),this.#i(t))break}catch(i){throw console.error("Dispatcher error:",i),i}}batch(t){let r=[];return t.forEach(({event:o,subscription:i,constraint:s=null,sort:e=!0,symbol:u=null,anchor:l=null})=>{r.push(this.listen({event:o,subscription:i,constraint:s,sort:e,symbol:u,anchor:l}))}),()=>{r.forEach(o=>{o()})}}listen({event:t,subscription:r,constraint:o=null,sort:i=!0,symbol:s=null,anchor:e=null}){return this.register(t,r,o,i,s,e)}register(t,r,o=null,i=!0,s=null,e=null){s??=this.#c();let u=this.#u(r,o,e),l=this.#l(t,s,u);return i&&this.#h(t),l}unregister(t,r){if(!this.#r[r]){console.warn("Tried to unregister not registered events",t);return}let o=[...this.#t[t]];this.#r[r].forEach(i=>{let s=o.indexOf(i);if(s!==-1)o.splice(s,1);else throw new Error("Attempt to remove event from wrong collection")}),this.#t[t]=o,delete this.#r[r]}#u(t,r=null,o=null){let i=Array.isArray(t)?t:[typeof t=="object"?t:{method:t}],s=[];for(let e of i)s.push({method:e.method,priority:e.priority??0,constraint:e.constraint??r,anchor:e.anchor??o});return s}#l(t,r,o){return this.#t[t]=[...this.#t[t]??[],...o],this.#r[r]=[...this.#r[r]??[],...o],()=>{this.unregister(t,r)}}#c(){return Symbol("event")}#i(t){return t.cancelBubble}#s(t){if(!(t instanceof CustomEvent))throw new Error("Event passed to dispatcher must be of type CustomEvent")}#e(t,r=null){let o=[];for(let i of this.#t[t]??[])this.#a(i,r)&&o.push(i);return o}#a(t,r){return!t.anchor||t.anchor===r||t.anchor.contains(r)}#n(t){let r=t.constraint,o=typeof r=="string"?this.#o?.get(r):r,i=t.method;if(o&&typeof i=="string"&&(i=o[i]??null,i&&(i=i.bind(o))),typeof i!="function")throw console.error("Error below is related to this subscriber",t),new Error("Subscriber doesn't have proper method");return i}#h(t){this.#t[t].sort((r,o)=>r.priority-o.priority)}};var p=n;export{n as Herald,p as default};
