"use strict";var s=function(i,t,r,e){if(r==="a"&&!e)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?i!==t||!e:!t.has(i))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?e:r==="a"?e.call(i):e?e.value:t.get(i)},w=function(i,t,r,e,o){if(e==="m")throw new TypeError("Private method is not writable");if(e==="a"&&!o)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?i!==t||!o:!t.has(i))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e==="a"?o.call(i,r):o?o.value=r:t.set(i,r),r},u,f,h,d,b,_,p;export class Herald{constructor(){u.add(this),f.set(this,void 0),h.set(this,{}),d.set(this,{})}inject(t){s(this,f,"f")||(w(this,f,t,"f"),s(this,u,"m",_).call(this))}async dispatch(t){if(!(t instanceof CustomEvent))throw new Error("Event passed to dispatcher must be of type CustomEvent");const{marshal:r}=s(this,f,"f"),e=t.type,o=[...s(this,h,"f")[e]??[]];for(const a of o)try{const n=a.constraint,c=typeof n=="string"?r.get(n):n;let l=a.method;if(c&&typeof l=="string"&&(l=c[l]??null,l&&(l=l.bind(c))),typeof l!="function")throw console.error("Error below references this object",n),new Error("Module "+String(n.constructor??n)+" doesn't have non-static method "+String(a.method));if(await l(t),t.cancelBubble)break}catch(n){throw console.error("Dispatcher error:",n),n}}register(t,r,e=null,o=!0,a=null){a??(a=Symbol("event"));const n=Array.isArray(r)?r:[typeof r=="object"?r:{method:r}];for(const c of n){if(c.priority??(c.priority=0),c.priority<-256||c.priority>256)throw console.error("Subscriber priority must be in range -256:256",{[t]:c}),new Error("Error above stopped registration of an event");c.constraint??(c.constraint=e)}return s(this,h,"f")[t]=[...s(this,h,"f")[t]??[],...n],s(this,d,"f")[a]=[...s(this,d,"f")[a]??[],...n],o&&s(this,u,"m",p).call(this,t),()=>{this.unregister(t,a)}}unregister(t,r){if(!s(this,d,"f")[r]){console.warn("Tried to unregister not registered events",t);return}const e=[...s(this,h,"f")[t]];s(this,d,"f")[r].forEach(o=>{const a=e.indexOf(o);if(a!==-1)e.splice(a,1);else throw new Error("Attempt to remove event from wrong collection")}),s(this,h,"f")[t]=e,delete s(this,d,"f")[r]}}f=new WeakMap,h=new WeakMap,d=new WeakMap,u=new WeakSet,b=function(t){return typeof t=="object"&&!Array.isArray(t)&&t!==null},_=function(){const{marshal:t}=s(this,f,"f");w(this,h,{},"f"),s(this,f,"f").subscribers.forEach(r=>{const e=r.module.subscriptions??r.module.constructor?.subscriptions;typeof e=="object"&&s(this,u,"m",b).call(this,e)&&Object.keys(e).forEach(o=>{this.register(o,e[o],t.getModuleConstraint(r.config),!1)})}),Object.keys(s(this,h,"f")).forEach(r=>{s(this,u,"m",p).call(this,r)})},p=function(t){s(this,h,"f")[t].sort((r,e)=>r.priority-e.priority)},Herald.inject={marshal:"boardmeister/marshal",subscribers:"!subscriber"};const y=Herald;export default y;
