"use strict";var f=function(t,r,i){return typeof r=="symbol"&&(r=r.description?"[".concat(r.description,"]"):""),Object.defineProperty(t,"name",{configurable:!0,value:i?"".concat(i," ",r):r})},n;const h=(n=class{constructor(){this.subscribers={}}inject(t){this.injected=t,this.sortSubscribers()}async dispatch(t){if(!(t instanceof CustomEvent))throw new Error("Event passed to dispatcher must be of type CustomEvent");const{marshal:r}=this.injected,i=t.type,s=this.subscribers[i]??[];for(const o of s)try{const c=r.getModuleConstraint(o.config),e=r.get(c);if(!e)throw new Error("Module "+c+" doesn't exist");if(typeof e[o.method]!="function")throw new Error("Module "+c+" doesn't have non-static method "+o.method);if(await e[o.method](t),t.cancelBubble)break}catch(c){console.error("Dispatcher error:",c)}}isObject(t){return typeof t=="object"&&!Array.isArray(t)&&t!==null}sortSubscribers(){const t={};this.injected.subscribers.forEach(r=>{const i=r.module.subscriptions??r.module.constructor?.subscriptions;typeof i=="object"&&this.isObject(i)&&Object.keys(i).forEach(s=>{t[s]||(t[s]=[]),this.isObject(i[s])?t[s]=[...t[s],{...i[s],config:r.config}]:Array.isArray(i[s])?t[s]=[...t[s],...i[s].map(o=>({...o,config:r.config}))]:t[s]=[...t[s],{method:i[s],priority:0,config:r.config}]})}),Object.keys(t).forEach(r=>{t[r].sort(function(i,s){return i.priority-s.priority})}),this.subscribers=t}},f(n,"Herald"),n.inject={marshal:"boardmeister/marshal",subscribers:"!subscriber"},n);export default h;
